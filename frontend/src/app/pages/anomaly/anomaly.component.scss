// src/app/pages/historic/historic.component.scss - Updated for Loading Overlay

// Import Nebular theme functions
@use "@nebular/theme/styles/theming" as *;
@use "@nebular/theme/styles/themes/default" as *;

// Main container styling
.row {
  margin-bottom: 1.5rem;

  &:last-child {
    margin-bottom: 0;
  }
}

// Date range form styling
.date-range-form {
  .label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    display: block;
    color: nb-theme(text-basic-color);
  }

  .form-control {
    margin-bottom: 1rem;
  }

  .quick-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;

    .btn {
      flex: 0 0 auto;
    }
  }
}

// Content Area - Relative positioning for overlay
.content-area {
  position: relative;
  min-height: 300px; // Ensure it has some height even when empty initially
}

// Charts section - Full width layout
.charts-section {
  width: 100%;
  transition: opacity 0.3s ease-in-out; // Smooth transition for loading state

  // Styles when loading is active
  &.loading-active {
    opacity: 0.4;
    pointer-events: none; // Prevent interaction with charts during load
    filter: blur(2px); // Optional: add a blur effect
  }

  // Make each chart row take full width
  .row {
    width: 100%;
    margin-left: 0;
    margin-right: 0;

    .col-12,
    .col-md-6 {
      padding-left: 0;
      padding-right: 0;
      // Removed width: 100% here, rely on bootstrap grid
    }
  }

  // Chart card styling
  .chart-card {
    margin-bottom: 2rem;
    box-shadow: nb-theme(card-shadow);
    border: 1px solid nb-theme(card-border-color);
    border-radius: nb-theme(card-border-radius);

    nb-card-header {
      padding: 1.25rem 1.5rem;
      border-bottom: 1px solid nb-theme(card-separator-color);
      background-color: nb-theme(card-header-background-color);

      .chart-title {
        margin: 0;
        font-size: 1.1rem;
        font-weight: 600;
        color: nb-theme(text-basic-color);
        display: flex;
        align-items: center;

        nb-icon {
          margin-right: 0.5rem;
          font-size: 1.2rem;
        }
      }
    }

    nb-card-body {
      padding: 1.5rem;
      background-color: nb-theme(card-background-color);

      // ECharts container styling
      .echart {
        width: 100%;
        height: 400px; // Fixed height for better visibility
        display: block;
        border-radius: 4px;
        overflow: hidden;

        // Ensure proper sizing
        // ::ng-deep echarts-directive { // Use ::ng-deep carefully if needed
        //   width: 100% !important;
        //   height: 100% !important;
        //   display: block;
        // }

        // ECharts canvas styling
        canvas {
          border-radius: 4px;
        }
      }
    }
  }
}

// Loading Overlay Styling
.loading-overlay {
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  background-color: rgba(
    nb-theme(background-basic-color-1),
    0.8
  ); // Semi-transparent background based on theme
  z-index: 10;
  border-radius: nb-theme(card-border-radius); // Match card radius
  text-align: center;
  padding: 2rem;

  nb-spinner {
    margin-bottom: 1rem;
  }

  h6 {
    color: nb-theme(text-basic-color);
    margin-bottom: 0.5rem;
  }

  p {
    color: nb-theme(text-hint-color);
    margin: 0;
  }
}

// No data state styling (wrapper and container)
.no-data-container-wrapper {
  margin-top: 1rem; // Add some space if it appears after the form
}

.no-data-container {
  text-align: center;
  padding: 3rem 2rem;

  .no-data-icon {
    margin-bottom: 1.5rem;
    opacity: 0.6;
  }

  .no-data-title {
    color: nb-theme(text-basic-color);
    margin-bottom: 1rem;
    font-size: 1.25rem;
  }

  .no-data-message {
    color: nb-theme(text-hint-color);
    margin: 0;
    line-height: 1.5;
  }
}

// Form button styling
.form-buttons {
  display: flex;
  flex-wrap: wrap;
  gap: 0.75rem;
  align-items: center;

  .primary-btn {
    display: flex;
    align-items: center;
    gap: 0.5rem;

    nb-icon {
      font-size: 1rem;

      &.spin {
        animation: spin 1s linear infinite;
      }
    }
  }

  .quick-select-buttons {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-left: auto;

    @media (max-width: 768px) {
      margin-left: 0;
      width: 100%;
      justify-content: flex-start;
    }
  }
}

// ECharts specific styling adjustments
.charts-section {
  .chart-card {
    nb-card-body {
      .echart {
        min-height: 400px;
        position: relative;

        @media (max-width: 768px) {
          height: 300px;
          min-height: 300px;
        }

        @media (max-width: 576px) {
          height: 250px;
          min-height: 250px;
        }
      }
    }
  }
}

// Responsive adjustments
@media (max-width: 768px) {
  .charts-section {
    .chart-card {
      margin-bottom: 1.5rem;

      nb-card-body {
        padding: 1rem;
      }
    }
  }

  .date-range-form {
    .row {
      .col-md-3 {
        margin-bottom: 1rem;
      }
    }

    .quick-buttons {
      justify-content: flex-start;

      .btn {
        flex: 1 1 auto;
        min-width: 80px;
      }
    }
  }
}

@media (max-width: 576px) {
  .charts-section {
    .chart-card {
      nb-card-header {
        padding: 1rem;

        .chart-title {
          font-size: 1rem;
        }
      }

      nb-card-body {
        padding: 0.75rem;
      }
    }
  }
}

// Animation for loading spinner
@keyframes spin {
  0% {
    transform: rotate(0deg);
  }
  100% {
    transform: rotate(360deg);
  }
}

// Print styles
@media print {
  .charts-section {
    .chart-card {
      break-inside: avoid;
      margin-bottom: 1rem;

      nb-card-body {
        .echart {
          height: 300px;
        }
      }
    }
  }

  .date-range-form,
  .form-buttons,
  .loading-overlay {
    // Hide overlay in print
    display: none;
  }
}

// Theme-specific adjustments
:host ::ng-deep {
  // Ensure ECharts tooltip works well with Nebular themes
  .echarts-tooltip {
    z-index: 9999 !important;
  }

  // Custom scrollbar for chart zoom areas (if needed)
  .echart {
    &::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }

    &::-webkit-scrollbar-track {
      background: nb-theme(background-basic-color-2);
      border-radius: 3px;
    }

    &::-webkit-scrollbar-thumb {
      background: nb-theme(color-basic-600);
      border-radius: 3px;

      &:hover {
        background: nb-theme(color-basic-700);
      }
    }
  }
}
