<!-- src/app/pages/server-selection/server-selection.component.html -->
<div class="server-selection-container">
  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <nb-spinner size="large"></nb-spinner>
    <p>Loading servers...</p>
  </div>

  <!-- Server Selection -->
  <div *ngIf="!loading" class="selection-container">
    <!-- Server Dropdown -->
    <div class="server-dropdown">
      <nb-select
        [(selected)]="selectedServerId"
        (selectedChange)="onServerChange($event)"
        placeholder="Select a server"
        size="medium"
      >
        <nb-option *ngFor="let server of servers" [value]="server.id">
          {{ server.hostname }} ({{ server.ip_address }})
        </nb-option>
      </nb-select>

      <!-- Add Server Button -->
      <button
        nbButton
        status="success"
        size="medium"
        (click)="openAddServerModal()"
      >
        <nb-icon icon="plus-outline"></nb-icon>
        Add Server
      </button>
    </div>

    <!-- Server Info and Actions -->
    <div *ngIf="selectedServer" class="server-info-actions">
      <div class="server-details">
        <h4>{{ selectedServer.hostname }}</h4>
        <small class="text-hint">
          {{ selectedServer.ip_address }}:{{ selectedServer.ssh_port }}
        </small>
      </div>

      <div class="server-status">
        <div class="status-item">
          <span class="status-label">Status:</span>
          <nb-badge
            [status]="getConnectionStatusBadge()"
            [text]="getConnectionStatusText()"
          ></nb-badge>
        </div>

        <div class="server-actions">
          <button
            nbButton
            ghost
            size="small"
            status="info"
            (click)="refreshServer()"
            title="Refresh connection"
          >
            <nb-icon icon="refresh-outline"></nb-icon>
          </button>

          <button
            nbButton
            ghost
            size="small"
            status="danger"
            (click)="removeServer()"
            title="Remove server"
          >
            <nb-icon icon="trash-2-outline"></nb-icon>
          </button>
        </div>
      </div>
    </div>

    <!-- Sub-navigation -->
    <nb-card *ngIf="selectedServer" class="sub-navigation-card">
      <nb-card-body>
        <nav class="sub-navigation">
          <button
            *ngFor="let route of subRoutes"
            [routerLink]="['/pages/servers', selectedServerId, route.path]"
            routerLinkActive="active"
            nbButton
            [status]="isSubRouteActive(route.path) ? 'primary' : 'basic'"
            [ghost]="!isSubRouteActive(route.path)"
            size="small"
            class="sub-nav-btn"
          >
            <nb-icon [icon]="route.icon"></nb-icon>
            {{ route.title }}
          </button>
        </nav>
      </nb-card-body>
    </nb-card>

    <!-- Router Outlet for Server Pages -->
    <div *ngIf="selectedServer" class="server-content">
      <router-outlet></router-outlet>
    </div>

    <!-- No Server Selected -->
    <div *ngIf="!selectedServer && !loading" class="no-server-container">
      <nb-card>
        <nb-card-body>
          <h5>No Server Selected</h5>
          <p>Please select a server from the dropdown above</p>
        </nb-card-body>
      </nb-card>
    </div>
  </div>

  <!-- Add Server Modal -->
  <nb-card *ngIf="showAddServerModal" class="add-server-modal">
    <nb-card-header>
      <h5>Add New Server</h5>
      <button nbButton ghost size="small" (click)="closeAddServerModal()">
        <nb-icon icon="close-outline"></nb-icon>
      </button>
    </nb-card-header>
    <nb-card-body>
      <ngx-add-server-form
        (serverAdded)="onServerAdded($event)"
        (cancelled)="closeAddServerModal()"
      ></ngx-add-server-form>
    </nb-card-body>
  </nb-card>

  <!-- Modal Backdrop -->
  <div
    *ngIf="showAddServerModal"
    class="modal-backdrop"
    (click)="closeAddServerModal()"
  ></div>
</div>
